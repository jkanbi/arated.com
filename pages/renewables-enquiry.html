<style>
    .enquiry-form-container {
        text-align: center;
        margin: 2em 0;
        padding: 0 1em;
    }
    
    .enquiry-form {
        max-width: 600px;
        margin: 2em auto;
        padding: 1.5em;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: #f9f9f9;
        display: inline-block;
        width: 100%;
        box-sizing: border-box;
    }
    
    .form-field {
        margin-bottom: 1em;
    }
    
    .form-field input,
    .form-field select,
    .form-field textarea {
        width: 100%;
        padding: 0.75em;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 1em;
        box-sizing: border-box;
        max-width: 100%;
    }
    
    .form-field textarea {
        font-family: inherit;
        resize: vertical;
    }
    
    .form-field select {
        color: #333;
    }
    
    .form-field select:invalid {
        color: #999;
    }
    
    @media (max-width: 768px) {
        .enquiry-form-container {
            margin: 1em 0;
            padding: 0 0.5em;
        }
        
        .enquiry-form {
            padding: 1em;
            margin: 1em auto;
            width: 100%;
        }
        
        .enquiry-form input,
        .enquiry-form select,
        .enquiry-form textarea {
            font-size: 16px !important; /* Prevents zoom on iOS */
        }
    }
    
    @media (max-width: 480px) {
        .enquiry-form {
            padding: 0.75em;
            border-radius: 4px;
        }
    }
</style>

<h1>Renewables Contact Form</h1>

<p>Interested in renewable energy solutions? Fill out the form below and we'll get back to you with expert guidance tailored to your needs.</p>

<div class="enquiry-form-container">
    <form action="https://forms.un-static.com/forms/36fb22519f35b2f136dde784ad8205c79d59100d" method="POST" class="enquiry-form">
        <div class="form-field">
            <input type="text" id="name" name="name" placeholder="Name *" required>
        </div>
        
        <div class="form-field">
            <input type="email" id="email" name="email" placeholder="Email *" required>
        </div>
        
        <div class="form-field">
            <input type="tel" id="phone" name="phone" placeholder="Phone">
        </div>
        
        <div class="form-field">
            <select id="technology" name="technology" required>
                <option value="" disabled selected>Which renewable technology are you interested in? *</option>
                <option value="Air Source Heat Pumps">Air Source Heat Pumps</option>
                <option value="Solar PV">Solar PV</option>
                <option value="Battery Storage">Battery Storage</option>
                <option value="EV Chargers">EV Chargers</option>
                <option value="Multiple Technologies">Multiple Technologies</option>
                <option value="Not Sure">Not Sure - Need Advice</option>
            </select>
        </div>
        
        <div class="form-field">
            <select id="timeframe" name="timeframe" required>
                <option value="" disabled selected>What is your time frame? *</option>
                <option value="Immediate (within 1 month)">Immediate (within 1 month)</option>
                <option value="Short term (1-3 months)">Short term (1-3 months)</option>
                <option value="Medium term (3-6 months)">Medium term (3-6 months)</option>
                <option value="Long term (6-12 months)">Long term (6-12 months)</option>
                <option value="Just exploring options">Just exploring options</option>
            </select>
        </div>
        
        <div class="form-field">
            <select id="property_type" name="property_type">
                <option value="" disabled selected>Property Type</option>
                <option value="Detached House">Detached House</option>
                <option value="Semi-Detached House">Semi-Detached House</option>
                <option value="Terraced House">Terraced House</option>
                <option value="Flat/Apartment">Flat/Apartment</option>
                <option value="Bungalow">Bungalow</option>
                <option value="Commercial">Commercial</option>
                <option value="Other">Other</option>
            </select>
        </div>
        
        <div class="form-field">
            <textarea id="message" name="message" rows="4" placeholder="Additional Information"></textarea>
        </div>
        
        <button type="submit" style="width: 100%; padding: 0.75em 1.5em; background-color: #000; color: white; border: none; border-radius: 4px; font-size: 1em; font-weight: 600; cursor: pointer; transition: background-color 0.3s; max-width: 100%;">Submit Enquiry</button>
    </form>
</div>

<p style="text-align: center; margin-top: 2em;">
    <a href="#/renewables" style="display: inline-block; padding: 0.75em 1.5em; background-color: #000; color: white; text-decoration: none; border-radius: 4px; font-weight: 600; width: auto;">‚Üê Back to Renewables</a>
</p>

<!-- Thank You Modal -->
<div id="thankYouModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5);">
    <div style="background-color: #fefefe; margin: 15% auto; padding: 2em; border: 1px solid #888; border-radius: 8px; width: 90%; max-width: 500px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); box-sizing: border-box;">
        <h2 style="margin-top: 0; color: #007bff;">Thank You!</h2>
        <p style="font-size: 1.1em; margin-bottom: 1.5em;">Thanks for getting in touch. We'll get back to you soon with expert guidance tailored to your needs.</p>
        <button type="button" id="closeModalBtn" style="padding: 0.75em 2em; background-color: #000; color: white; border: none; border-radius: 4px; font-size: 1em; font-weight: 600; cursor: pointer; transition: background-color 0.3s; width: auto; max-width: 100%;">Close</button>
    </div>
</div>

<style>
    @media (max-width: 768px) {
        #thankYouModal > div {
            margin: 20% auto !important;
            padding: 1.5em !important;
        }
    }
    
    @media (max-width: 480px) {
        #thankYouModal > div {
            margin: 30% auto !important;
            padding: 1em !important;
            width: 95% !important;
        }
        
        #thankYouModal h2 {
            font-size: 1.5em !important;
        }
        
        #thankYouModal p {
            font-size: 1em !important;
        }
    }
</style>

<script>
(function() {
    // Wait for DOM to be ready
    function initModal() {
        const form = document.querySelector('form');
        const modal = document.getElementById('thankYouModal');
        const closeBtn = document.getElementById('closeModalBtn');
        
        if (!modal) {
            console.error('Modal element not found');
            return;
        }
        
        // Function to get URL parameters (works with both hash and regular URLs)
        function getUrlParameter(name) {
            // Check hash-based query params (for SPA routing)
            const hash = window.location.hash;
            if (hash.includes('?')) {
                const hashParams = new URLSearchParams(hash.split('?')[1] || '');
                if (hashParams.has(name)) {
                    return hashParams.get(name);
                }
            }
            
            // Check regular query params
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }
        
        // Function to remove URL parameter
        function removeUrlParameter(name) {
            // Remove from hash
            const hash = window.location.hash;
            if (hash.includes('?')) {
                const [path, query] = hash.split('?');
                const params = new URLSearchParams(query);
                params.delete(name);
                const newQuery = params.toString();
                const newHash = newQuery ? path + '?' + newQuery : path;
                window.history.replaceState(null, '', '#' + newHash);
            }
            
            // Remove from regular query
            const url = new URL(window.location);
            url.searchParams.delete(name);
            window.history.replaceState(null, '', url.pathname + url.search + url.hash);
        }
        
        // Check if we should show the modal (from callback URL)
        function checkForCallback() {
            const submitted = getUrlParameter('submitted');
            const success = getUrlParameter('success');
            
            console.log('Checking for callback - submitted:', submitted, 'success:', success);
            
            if (submitted === 'true' || success === 'true') {
                console.log('Showing modal');
                modal.style.display = 'block';
                // Clean up URL parameters
                removeUrlParameter('submitted');
                removeUrlParameter('success');
                // Reset form if it exists
                if (form) {
                    form.reset();
                }
            }
        }
        
        // Check on initialization
        checkForCallback();
        
        // Also check when hash changes (for SPA navigation)
        window.addEventListener('hashchange', checkForCallback);
        
        // Close modal when clicking the close button
        if (closeBtn) {
            // Remove existing listeners by replacing the button
            const newCloseBtn = closeBtn.cloneNode(true);
            closeBtn.parentNode.replaceChild(newCloseBtn, closeBtn);
            
            newCloseBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                if (modal) {
                    modal.style.display = 'none';
                }
                return false;
            });
        }
        
        // Close modal when clicking outside of it
        if (modal) {
            modal.addEventListener('click', function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
        
        // Close modal with Escape key
        const escapeHandler = function(event) {
            if (event.key === 'Escape' && modal && modal.style.display === 'block') {
                modal.style.display = 'none';
            }
        };
        document.addEventListener('keydown', escapeHandler);
    }
    
    // Try to initialize immediately
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initModal);
    } else {
        // DOM is already ready, but wait a bit for dynamic content to load
        setTimeout(initModal, 100);
    }
    
    // Also try after a short delay in case content is loaded dynamically
    setTimeout(initModal, 500);
})();
</script>
